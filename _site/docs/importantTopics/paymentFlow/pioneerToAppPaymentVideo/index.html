<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/assets/css/pi-new_dev_onboarding-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/pi-new_dev_onboarding.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Video Integration - Pioneer to App Payments | Pi Developer Guide</title><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Video Integration - Pioneer to App Payments" /><meta property="og:locale" content="en_US" /><meta name="description" content="A guide for developers to build on Pi" /><meta property="og:description" content="A guide for developers to build on Pi" /><link rel="canonical" href="http://localhost:4000/docs/importantTopics/paymentFlow/pioneerToAppPaymentVideo/" /><meta property="og:url" content="http://localhost:4000/docs/importantTopics/paymentFlow/pioneerToAppPaymentVideo/" /><meta property="og:site_name" content="Pi Developer Guide" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Video Integration - Pioneer to App Payments" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"A guide for developers to build on Pi","headline":"Video Integration - Pioneer to App Payments","url":"http://localhost:4000/docs/importantTopics/paymentFlow/pioneerToAppPaymentVideo/"}</script><body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"> Pi Developer Guide </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/" class="nav-list-link">Welcome</a><li class="nav-list-item"><a href="http://localhost:4000/docs/communitySupport/" class="nav-list-link">Community Support</a><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/gettingStarted/" class="nav-list-link">Getting Started</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/docs/gettingSetup/piBrowserIntroduction/" class="nav-list-link">Pi Browser Introduction</a><li class="nav-list-item "><a href="http://localhost:4000/docs/gettingSetup/devPortal/" class="nav-list-link">Developer Portal</a><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/gettingSetup/piPlatform/" class="nav-list-link">Pi Platform</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/docs/gettingSetup/piPlatform/piSDK/" class="nav-list-link">Pi Platform SDK</a><li class="nav-list-item "> <a href="http://localhost:4000/docs/gettingSetup/piPlatform/videoIntegrationPiSDK/" class="nav-list-link">Video Ingtegration Pi SDK</a><li class="nav-list-item "> <a href="http://localhost:4000/docs/gettingSetup/piPlatform/piAPIs/" class="nav-list-link">Pi Platform APIs</a></ul></ul><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/importantTopics/" class="nav-list-link">Important Topics</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/docs/importantTopics/mainnetVsTestnet/" class="nav-list-link">Pi Mainnet vs Pi Testnet</a><li class="nav-list-item "><a href="http://localhost:4000/docs/importantTopics/accessToken/" class="nav-list-link">Access Token</a><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/importantTopics/paymentFlow/" class="nav-list-link">Pi Payments</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/docs/importantTopics/paymentFlow/piWallet/" class="nav-list-link">Pi Wallet Intro</a><li class="nav-list-item "> <a href="http://localhost:4000/docs/importantTopics/paymentFlow/developerPaymentFlow/" class="nav-list-link">Developer Payment Flow</a><li class="nav-list-item "> <a href="http://localhost:4000/docs/importantTopics/paymentFlow/pioneerToApp/" class="nav-list-link">Pioneer to App Payments</a><li class="nav-list-item active"> <a href="http://localhost:4000/docs/importantTopics/paymentFlow/pioneerToAppPaymentVideo/" class="nav-list-link active">Video Integration - Pioneer to App Payments</a></ul></ul></ul></nav></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Pi Developer Guide" aria-label="Search Pi Developer Guide" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="https://github.com/pi-apps/pi-platform-docs" class="site-button" > Pi Platform Github Docs </a></ul></nav></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/docs/importantTopics/">Important Topics</a><li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/docs/importantTopics/paymentFlow/">Pi Payments</a><li class="breadcrumb-nav-list-item"><span>Video Integration - Pioneer to App Payments</span></ol></nav><div id="main-content" class="main-content" role="main"><h1 class="no_toc" id="video-integration-of-pioneer-to-app-payments"> <a href="#video-integration-of-pioneer-to-app-payments" class="anchor-heading" aria-labelledby="video-integration-of-pioneer-to-app-payments"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Video Integration of Pioneer to App Payments</h1><h2 class="no_toc text-delta" id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of contents</h2><ol id="markdown-toc"><li><a href="#captions" id="markdown-toc-captions">Captions</a><ol><li><a href="#introduction" id="markdown-toc-introduction">Introduction</a><li><a href="#create-payment" id="markdown-toc-create-payment">Create Payment</a><li><a href="#onreadyforserverapproval" id="markdown-toc-onreadyforserverapproval">onReadyForServerApproval</a><li><a href="#onreadyforservercompletion" id="markdown-toc-onreadyforservercompletion">onReadyForServerCompletion</a><li><a href="#onincompletepaymentfound" id="markdown-toc-onincompletepaymentfound">onIncompletePaymentFound</a><li><a href="#generate-server-api-key" id="markdown-toc-generate-server-api-key">Generate Server API Key</a><li><a href="#callback-functions" id="markdown-toc-callback-functions">Callback Functions</a><li><a href="#server-side" id="markdown-toc-server-side">Server Side</a><li><a href="#testing" id="markdown-toc-testing">Testing</a></ol></ol><div class="embed-container"> <iframe src="https://www.youtube.com/embed/rvrmaDu61Tc" width="700" height="480" frameborder="0" allowfullscreen=""> </iframe></div><p>Captions for the video can also be found on our <a href="https://pinetwork-official.medium.com/hackathon-workshop-transcripts-86367175ebb3">Medium Blog Post</a></p><h2 id="captions"> <a href="#captions" class="anchor-heading" aria-labelledby="captions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Captions</h2><h3 id="introduction"> <a href="#introduction" class="anchor-heading" aria-labelledby="introduction"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Introduction</h3><p>Welcome back everyone. In the previous video, we saw how to use the Pi SDK, run your app in the sandbox and authenticate the user. In this video, I’m going to walk you through the overall payment process. The process I’m about to explain is at a very high level, but even with this, you’ll be able to understand what you need to do to create a payment. If you want to learn more about what’s actually happening behind the scene, please refer to our Pi Platform Documentation. Now let’s begin.</p><p>Throughout the process, essentially 4 parties are involved. Your app, Your App Server, the Pi Servers and the Pi Blockchain. The most important point to remember is that all of them must be completely synchronized about the state of a payment to avoid any possible race conditions. If something goes wrong, a user may pay for an item that’s already given to someone else, or a user may pay for an item twice because the process gets interrupted. To avoid such cases, the Pi Core Team has implemented a protocol as a part of the Pi SDK and you don’t need to worry at all.</p><h3 id="create-payment"> <a href="#create-payment" class="anchor-heading" aria-labelledby="create-payment"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Create Payment</h3><p>With the Pi SDK, creating a payment in Pi Apps is very simple. Let’s have a look at the createPayment function. It takes 2 arguments, which are paymentData object and an object of callback functions. The paymentData object is comprised of three items. Amount to be paid, memo for users, and metadata for your own usage. If any of these are missing, you’ll get an error.</p><h3 id="onreadyforserverapproval"> <a href="#onreadyforserverapproval" class="anchor-heading" aria-labelledby="onreadyforserverapproval"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> onReadyForServerApproval</h3><p>onReadyForServerApproval is a function that gets called when the payment id is ready. Using this function, you need to pass payment id and other relevant data to your app server. Then on your server, you should reserve an item for the user who’s about to buy it, and let Pi server know that you’re ready to proceed. In other words, you need to make sure that your server is aware of the current payment through this function.</p><h3 id="onreadyforservercompletion"> <a href="#onreadyforservercompletion" class="anchor-heading" aria-labelledby="onreadyforservercompletion"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> onReadyForServerCompletion</h3><p>onReadyForServerCompletion is a function that gets called after the blockchain transaction has been submitted to the Pi blockchain. Your job is again to pass any relevant data to your app server. On your server, you can verify the payment and deliver the item that was reserved for the user. In the end, you should complete the payment by letting the Pi server know that you have received the payment and delivered the item. The other 2 functions are onCancel and onError functions. As their names suggest, they are functions that will be invoked when the payment gets canceled and when an error occurs.</p><h3 id="onincompletepaymentfound"> <a href="#onincompletepaymentfound" class="anchor-heading" aria-labelledby="onincompletepaymentfound"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> onIncompletePaymentFound</h3><p>Let’s not forget about the onIncompletePaymentFound function that we saw in the previous video. To remind you, this function is in charge of completing any incomplete payment. You might be wondering why you need to implement this function. There’s a chance that a payment process gets interrupted unexpectedly. A user might lose the internet connection, the app might crash or the server might not respond. If the payment process fails before a user pays, then it’s fine. The user just needs to start the process again. Of course, you need to clean up the stale orders on your server. But what if the user already paid and all of a sudden the process ends without being completed gracefully? That’s where this function comes in and plays the role. The Pi SDK will detect such payment when the user is authenticated and when a user tries to make a new payment, and if it finds an incomplete payment, it will request your app to complete the payment. Okay, so we are going to implement the functions in a minute. But there’s one more step you can’t forget, which is obtaining the API Key.</p><h3 id="generate-server-api-key"> <a href="#generate-server-api-key" class="anchor-heading" aria-labelledby="generate-server-api-key"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Generate Server API Key</h3><p>Assuming that you have registered your app on the developer portal, let’s generate the API Key, if you haven’t done yet. Select your app at the bottom, and if you tap on the “get api key” button, you can create a new key. Save the key before you close the window. Using this key, you can hit our endpoints and update the status of the Payment.</p><h3 id="callback-functions"> <a href="#callback-functions" class="anchor-heading" aria-labelledby="callback-functions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Callback Functions</h3><p>We are back to our demo app, and now we are going to implement the callback functions. For the sake of time, I have prepared the code snippet. Let’s fill this in together. We now all know what this is. What you want to do here is to call your server to hit our endpoint from your server. Keep in mind that this slash approve is just an arbitrary route I’m using as an example. Again, to complete the payment, you need to call your server to hit our endpoint. The last two functions are for your own usage. When the payment is canceled, mark it as cancelled on your server as well. Also handle the error however you want.</p><h3 id="server-side"> <a href="#server-side" class="anchor-heading" aria-labelledby="server-side"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Server Side</h3><p>Now let’s complete the backend. In this demo, I’m running the node server, but you can choose any backend you prefer. Also keep in mind that the actual implementation is up to you. I’m just demonstrating a rough example to help you understand the process. First, let’s see the approve route. When the payment is created, you need to reserve an item for the user, and map the paymentId to the current order. Then make sure to hit approve endpoint to approve the payment. The same thing goes for the complete route as well. You can verify the payment if you want, deliver the item to the user, mark the order as paid and complete the payment by hitting complete endpoint. We shouldn’t forget the incomplete route. Process the incomplete payment, and hit the complete endpoint. Although I’m skipping here, don’t forget to handle the cancel route as well. We are finally ready to create a payment.</p><h3 id="testing"> <a href="#testing" class="anchor-heading" aria-labelledby="testing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Testing</h3><p>Now that the code is ready, let’s see the flow from the beginning. As soon as I tap on the button, the payment flow begins. I can see the next page only if the payment is approved from the app server. Then I can review the details and if I think it’s correct, I’ll use my passphrase to sign and submit the transaction to the Pi blockchain. Now the transaction is submitted, and we are waiting for the app server to complete the payment flow. When the app server finally completes the payment, I can see this result, and this is the end of the demo. Thanks for watching.</p><hr><footer><p><a href="#top" id="back-to-top">Back to top</a></p><p class="text-small text-grey-dk-100 mb-0">Copyright &copy; 2017-2020 Patrick Marsceill. Distributed by an <a href="https://github.com/just-the-docs/just-the-docs/tree/main/LICENSE.txt">MIT license.</a></p><div class="d-flex mt-2"><p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/pi-apps/pi-platform-docs/tree/main/docs/importantTopics/paymentFlow/pioneerToAppPaymentVideo.md" id="edit-this-page">Edit this page on GitHub</a></p></div></footer></div></div><div class="search-overlay"></div></div>
